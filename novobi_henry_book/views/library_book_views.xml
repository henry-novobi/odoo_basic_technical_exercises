<?xml version="1.0" encoding="utf-8"?>
<!-- Copyright Â© 2022 Novobi, LLC. See LICENSE file for full copyright and licensing details. -->

<odoo>

    <!--############################## VIEWS ##############################-->
    <record id="library_book_view_form_inherited" model="ir.ui.view">
        <field name="name">library.book.view.form.inherited</field>
        <field name="model">library.book</field>
        <field name="inherit_id" ref = "novobi_library_book.library_book_view_form"/>
        <field name="arch" type="xml">
            <xpath expr = "/form/header" position = "inside">
                <button name = "library_borrower_action" type = "object" string = "Lease" groups = "novobi_library_book.group_librarian,novobi_henry_book.group_librarian_assistant"/>
            </xpath>
            <xpath expr = "//field[@name='author_ids']" position = "after">
                <field name = "ISBN"/>
                <field name = "location_id"/>                
            </xpath>
            <xpath expr = "//field[@name='date_release']" position = "after">
                <field name = "url"/>
                <field name = "status"/>
                <field name = "current_borrower_id"/>
            </xpath>
            <xpath expr = "//sheet" position = "after">
                <div class="oe_chatter">
                    <field name="message_follower_ids" widget="mail_followers"/>
                    <field name = "activity_ids"/>
                    <field name="message_ids" widget="mail_thread"/>
                </div>
            </xpath>
        </field>   
    </record>


    <record id="library_book_view_tree_inherited" model="ir.ui.view">
        <field name="name">library.book.view.tree.inherited</field>
        <field name="model">library.book</field>
        <field name="inherit_id" ref = "novobi_library_book.library_book_view_tree"/>
        <field name="arch" type="xml">
            <xpath expr = "//field[@name='date_release']" position = "after">
                <field name = "ISBN"/>
                <field name = "short_name"/>
                <field name = "status"/>
                <button name = "open_website_url" type = "object" string = "Goto Web"/>
            </xpath>
        </field>
    </record>


    <record id="library_book_view_search_inherited" model="ir.ui.view">
        <field name="name">library.book.view.search.inherited</field>
        <field name="model">library.book</field>
        <field name="inherit_id" ref = "novobi_library_book.library_book_view_search"/>
        <field name="arch" type="xml">
            <xpath expr = "//field[@name='name']" position = "after">
                <field name = "ISBN"/>
                <filter string = "Without Release Date" name = "without_release" domain = "[('date_release','=',False)]"/>
                <filter name = "status" context = "{'group_by': 'status'}"/>
            </xpath>
        </field>
    </record>


    <record model="ir.actions.server" id="action_mark_book_lost">
        <field name="name">Mark as Lost</field>
        <field name="sequence">6</field>
        <field name="model_id" ref="model_library_book"/>
        <field name="binding_model_id" ref="model_library_book"/>
        <field name="binding_view_types">form,list</field>
        <field name="state">code</field>
        <field name="groups_id" eval="[(4, ref('novobi_library_book.group_librarian')), (4, ref('group_librarian_assistant'))]"/>
        <field name="code">
             action = records._change_book_status('lost')
        </field>
    </record>


    <record model="ir.actions.server" id="action_mark_book_available">
        <field name="name">Mark as Available</field>
        <field name="sequence">7</field>
        <field name="model_id" ref="model_library_book"/>
        <field name="binding_model_id" ref="model_library_book"/>
        <field name="binding_view_types">form,list</field>
        <field name="state">code</field>
        <field name="groups_id" eval="[(4, ref('novobi_library_book.group_librarian')), (4, ref('group_librarian_assistant'))]"/>
        <field name="code">
             action = records._change_book_status('available')
        </field>
    </record>

</odoo>